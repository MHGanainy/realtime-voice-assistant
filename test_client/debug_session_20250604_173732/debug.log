[17:37:32.978] [DEVICES] Found 3 input devices
[17:37:33.687] [MAIN] Starting application
[17:37:33.687] [SESSION] Requesting session from server
[17:37:33.772] [SESSION] Requesting new session ID
[17:37:33.774] [SESSION] Got session ID: e85cfe47-d4e0-46fb-ad9b-26d7f01be7a6
[17:37:33.774] [CONNECTION] Attempting WebSocket connection to ws://localhost:8000/ws/audio?session=e85cfe47-d4e0-46fb-ad9b-26d7f01be7a6
[17:37:33.774] [WEBSOCKET_PARAMS] Connection parameters
    Data: {'url': 'ws://localhost:8000/ws/audio?session=e85cfe47-d4e0-46fb-ad9b-26d7f01be7a6', 'max_size': 100000000, 'compression': None}
[17:37:33.825] [CONNECTION] WebSocket connected
    Data: {'compression': 'None', 'state': '1', 'local_address': "('127.0.0.1', 56244)", 'remote_address': "('127.0.0.1', 8000)"}
[17:37:33.825] [FLOW] === AUDIO FLOW STARTING ===
[17:37:33.825] [AUDIO_INIT] Preparing to open audio input stream
[17:37:33.893] [AUDIO] Opened input stream
    Data: {'device_index': 3, 'format': 'pyaudio.paInt16', 'channels': 1, 'rate': 16000, 'chunk_size': 1600, 'callback_registered': True}
[17:37:33.893] [FLOW] Starting recording flag
[17:37:33.894] [AUDIO_START] Starting audio stream
[17:37:33.894] [AUDIO_STARTED] Audio stream is now active
[17:37:33.894] [TASKS] Creating async tasks
[17:37:33.894] [TASK_CREATE] Creating send_audio task
[17:37:33.894] [TASK_CREATE] Creating receive_responses task
[17:37:33.894] [TASKS] Both tasks created and running
[17:37:33.894] [THREAD] Enter key listener thread started
[17:37:33.894] [INPUT] Waiting for user to press Enter
[17:37:33.894] [MAIN_LOOP] Entering main wait loop
[17:37:33.894] [SEND] Started send_audio task
[17:37:33.894] [FLOW] SEND TASK: Waiting for audio from queue...
[17:37:33.894] [QUEUE_STATE] Queue has 0 items
[17:37:33.999] [QUEUE_EMPTY] No audio in queue, waiting...
[17:37:34.000] [QUEUE_STATE] Queue has 0 items
[17:37:34.026] [CALLBACK] Audio callback #1
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:37:34.027] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:37:34.027] [AUDIO_IN] Captured chunk 0
    Data: {'label': 'input', 'size_bytes': 3200, 'duration_ms': 100, 'sample_count': 1600, 'max_value': 8, 'min_value': -115, 'avg_value': -59, 'is_silence': True, 'format': 'PCM'}
[17:37:34.027] [FLOW] Got audio from queue: 3200 bytes
[17:37:34.027] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.027] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:37:34.027] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.027] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3234, 'overhead_bytes': 34, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:37:34.027] [PROTOBUF_HEX] First message hex dump
    Data: {'first_50_bytes': '129f1912154f7574707574417564696f5261774672616d6523301a8019060008000200f9ffeaffdaffceffc4ffb8ffb0ffa9', 'last_10_bytes': '000000000020807d2801'}
[17:37:34.028] [WEBSOCKET_SEND] Sending 3234 bytes via WebSocket
[17:37:34.028] [WEBSOCKET_SENT] Successfully sent chunk 0
[17:37:34.126] [CALLBACK] Audio callback #2
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:37:34.127] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:37:34.127] [FLOW] Got audio from queue: 3200 bytes
[17:37:34.127] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.127] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:37:34.127] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.128] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:37:34.128] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.129] [WEBSOCKET_SENT] Successfully sent chunk 1
[17:37:34.226] [CALLBACK] Audio callback #3
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:37:34.227] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:37:34.227] [FLOW] Got audio from queue: 3200 bytes
[17:37:34.228] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.228] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:37:34.229] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.229] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:37:34.230] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.230] [WEBSOCKET_SENT] Successfully sent chunk 2
[17:37:34.326] [CALLBACK] Audio callback #4
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:37:34.327] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:37:34.327] [FLOW] Got audio from queue: 3200 bytes
[17:37:34.327] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.328] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:37:34.328] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.328] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:37:34.328] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.328] [WEBSOCKET_SENT] Successfully sent chunk 3
[17:37:34.427] [CALLBACK] Audio callback #5
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:37:34.427] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:37:34.428] [FLOW] Got audio from queue: 3200 bytes
[17:37:34.429] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.429] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:37:34.429] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.430] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:37:34.431] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.431] [WEBSOCKET_SENT] Successfully sent chunk 4
[17:37:34.527] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.527] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.527] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.527] [WEBSOCKET_SENT] Successfully sent chunk 5
[17:37:34.627] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.627] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.628] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.629] [WEBSOCKET_SENT] Successfully sent chunk 6
[17:37:34.727] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.728] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.729] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.729] [WEBSOCKET_SENT] Successfully sent chunk 7
[17:37:34.827] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.828] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.828] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.829] [WEBSOCKET_SENT] Successfully sent chunk 8
[17:37:34.927] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:34.928] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:34.928] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:37:34.929] [WEBSOCKET_SENT] Successfully sent chunk 9
[17:37:34.929] [QUEUE_STATE] Queue has 0 items
[17:37:35.027] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.027] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.028] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.029] [WEBSOCKET_SENT] Successfully sent chunk 10
[17:37:35.127] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.127] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.128] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.129] [WEBSOCKET_SENT] Successfully sent chunk 11
[17:37:35.227] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.227] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.228] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.228] [WEBSOCKET_SENT] Successfully sent chunk 12
[17:37:35.327] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.327] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.328] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.328] [WEBSOCKET_SENT] Successfully sent chunk 13
[17:37:35.427] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.427] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.428] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.429] [WEBSOCKET_SENT] Successfully sent chunk 14
[17:37:35.527] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.527] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.528] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.528] [WEBSOCKET_SENT] Successfully sent chunk 15
[17:37:35.627] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.627] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.628] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.628] [WEBSOCKET_SENT] Successfully sent chunk 16
[17:37:35.727] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.727] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.728] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.728] [WEBSOCKET_SENT] Successfully sent chunk 17
[17:37:35.827] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.827] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.828] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.828] [WEBSOCKET_SENT] Successfully sent chunk 18
[17:37:35.927] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:35.927] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:35.928] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:35.929] [WEBSOCKET_SENT] Successfully sent chunk 19
[17:37:35.929] [QUEUE_STATE] Queue has 0 items
[17:37:36.027] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.028] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.028] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3237, 'overhead_bytes': 37, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:37:36.029] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.030] [WEBSOCKET_SENT] Successfully sent chunk 20
[17:37:36.127] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.128] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.128] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.129] [WEBSOCKET_SENT] Successfully sent chunk 21
[17:37:36.227] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.227] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.228] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.229] [WEBSOCKET_SENT] Successfully sent chunk 22
[17:37:36.327] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.327] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.328] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.329] [WEBSOCKET_SENT] Successfully sent chunk 23
[17:37:36.427] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.427] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.428] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.428] [WEBSOCKET_SENT] Successfully sent chunk 24
[17:37:36.527] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.527] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.528] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.528] [WEBSOCKET_SENT] Successfully sent chunk 25
[17:37:36.627] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.627] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.628] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.628] [WEBSOCKET_SENT] Successfully sent chunk 26
[17:37:36.727] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.728] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.728] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.729] [WEBSOCKET_SENT] Successfully sent chunk 27
[17:37:36.827] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.828] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.829] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.829] [WEBSOCKET_SENT] Successfully sent chunk 28
[17:37:36.927] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:36.928] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:36.929] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:36.929] [WEBSOCKET_SENT] Successfully sent chunk 29
[17:37:36.930] [QUEUE_STATE] Queue has 0 items
[17:37:37.027] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:37.028] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:37.028] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:37.029] [WEBSOCKET_SENT] Successfully sent chunk 30
[17:37:37.127] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:37.127] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:37.128] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:37.129] [WEBSOCKET_SENT] Successfully sent chunk 31
[17:37:37.227] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:37:37.227] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:37:37.228] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:37:37.229] [WEBSOCKET_SENT] Successfully sent chunk 32
[17:37:37.271] [INPUT] Enter pressed by user
[17:37:37.271] [USER] Stop requested
[17:37:37.333] [SEND] Ended send_audio task
    Data: {'total_chunks': 33, 'total_bytes': 105600}
[17:37:37.333] [RECEIVE] Started receive_responses task
[17:37:37.334] [FLOW] RECEIVE TASK: Waiting for server messages...
[17:37:37.335] [WEBSOCKET_RECV] Waiting for message #1
[17:37:37.335] [SHUTDOWN] Beginning shutdown sequence
[17:37:37.336] [AUDIO_STOP] Stopping audio input stream
[17:37:37.451] [AUDIO] Input stream closed
[17:37:37.451] [WAIT] Waiting 3 seconds for final responses
[17:37:40.453] [PLAYBACK_STOP] Setting stop flag for playback thread
[17:37:40.453] [TASKS_CANCEL] Cancelling async tasks
[17:37:40.454] [TASKS_CANCELLED] All tasks cancelled
[17:37:40.455] [COMPLETE] Session ended successfully
[17:37:40.457] [CLEANUP] Starting final cleanup
[17:37:40.457] [CLEANUP] Audio terminated
