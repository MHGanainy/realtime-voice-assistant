[17:43:14.935] [DEVICES] Found 3 input devices
[17:43:15.590] [MAIN] Starting application
[17:43:15.590] [SESSION] Requesting session from server
[17:43:15.676] [SESSION] Requesting new session ID
[17:43:15.678] [SESSION] Got session ID: 03df6b8c-bdb4-483f-b972-e9e6520b84ee
[17:43:15.678] [CONNECTION] Attempting WebSocket connection to ws://localhost:8000/ws/audio?session=03df6b8c-bdb4-483f-b972-e9e6520b84ee
[17:43:15.678] [WEBSOCKET_PARAMS] Connection parameters
    Data: {'url': 'ws://localhost:8000/ws/audio?session=03df6b8c-bdb4-483f-b972-e9e6520b84ee', 'max_size': 100000000, 'compression': None}
[17:43:15.734] [CONNECTION] WebSocket connected
    Data: {'compression': 'None', 'state': '1', 'local_address': "('127.0.0.1', 56306)", 'remote_address': "('127.0.0.1', 8000)"}
[17:43:15.734] [FLOW] === AUDIO FLOW STARTING ===
[17:43:15.734] [AUDIO_INIT] Preparing to open audio input stream
[17:43:15.803] [AUDIO] Opened input stream
    Data: {'device_index': 3, 'format': 'pyaudio.paInt16', 'channels': 1, 'rate': 16000, 'chunk_size': 1600, 'callback_registered': True}
[17:43:15.803] [FLOW] Starting recording flag
[17:43:15.803] [AUDIO_START] Starting audio stream
[17:43:15.803] [AUDIO_STARTED] Audio stream is now active
[17:43:15.803] [TASKS] Creating async tasks
[17:43:15.803] [TASK_CREATE] Creating send_audio task
[17:43:15.803] [TASK_CREATE] Creating receive_responses task
[17:43:15.803] [TASKS] Both tasks created and running
[17:43:15.803] [INPUT] Waiting for user to press Enter
[17:43:15.803] [THREAD] Enter key listener thread started
[17:43:15.803] [MAIN_LOOP] Entering main wait loop
[17:43:15.804] [SEND] Started send_audio task
[17:43:15.804] [FLOW] SEND TASK: Waiting for audio from queue...
[17:43:15.804] [QUEUE_STATE] Queue has 0 items
[17:43:15.909] [QUEUE_EMPTY] No audio in queue, waiting...
[17:43:15.909] [QUEUE_STATE] Queue has 0 items
[17:43:15.937] [CALLBACK] Audio callback #1
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:43:15.937] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:43:15.937] [AUDIO_IN] Captured chunk 0
    Data: {'label': 'input', 'size_bytes': 3200, 'duration_ms': 100, 'sample_count': 1600, 'max_value': 136, 'min_value': -143, 'avg_value': -23, 'is_silence': True, 'format': 'PCM'}
[17:43:15.937] [FLOW] Got audio from queue: 3200 bytes
[17:43:15.938] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:15.938] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:43:15.938] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:15.938] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3234, 'overhead_bytes': 34, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:43:15.938] [PROTOBUF_HEX] First message hex dump
    Data: {'first_50_bytes': '129f1912154f7574707574417564696f5261774672616d6523301a8019f1ffe4ffe6ffc8ffdcffb7ffa9ffa3ff96ffabffab', 'last_10_bytes': '000000000020807d2801'}
[17:43:15.938] [WEBSOCKET_SEND] Sending 3234 bytes via WebSocket
[17:43:15.938] [WEBSOCKET_SENT] Successfully sent chunk 0
[17:43:16.036] [CALLBACK] Audio callback #2
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:43:16.037] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:43:16.038] [FLOW] Got audio from queue: 3200 bytes
[17:43:16.038] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.039] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:43:16.039] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.039] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:43:16.040] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.041] [WEBSOCKET_SENT] Successfully sent chunk 1
[17:43:16.136] [CALLBACK] Audio callback #3
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:43:16.137] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:43:16.137] [FLOW] Got audio from queue: 3200 bytes
[17:43:16.138] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.138] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:43:16.138] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.138] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:43:16.138] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.138] [WEBSOCKET_SENT] Successfully sent chunk 2
[17:43:16.236] [CALLBACK] Audio callback #4
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:43:16.237] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:43:16.237] [FLOW] Got audio from queue: 3200 bytes
[17:43:16.237] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.237] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:43:16.238] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.238] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:43:16.238] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.238] [WEBSOCKET_SENT] Successfully sent chunk 3
[17:43:16.337] [CALLBACK] Audio callback #5
    Data: {'frame_count': 1600, 'status': 0, 'data_size': 3200, 'is_recording': True}
[17:43:16.337] [QUEUE] Adding to queue
    Data: {'current_queue_size': 0, 'data_size': 3200}
[17:43:16.338] [FLOW] Got audio from queue: 3200 bytes
[17:43:16.338] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.338] [FRAME_DETAILS] Frame created
    Data: {'type': 'OutputAudioRawFrame', 'has_audio': True, 'audio_len': 3200, 'sample_rate': 16000, 'num_channels': 1}
[17:43:16.339] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.339] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3236, 'overhead_bytes': 36, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:43:16.340] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.340] [WEBSOCKET_SENT] Successfully sent chunk 4
[17:43:16.437] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.437] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.438] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.439] [WEBSOCKET_SENT] Successfully sent chunk 5
[17:43:16.537] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.537] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.537] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.538] [WEBSOCKET_SENT] Successfully sent chunk 6
[17:43:16.636] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.637] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.638] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.638] [WEBSOCKET_SENT] Successfully sent chunk 7
[17:43:16.737] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.738] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.738] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.739] [WEBSOCKET_SENT] Successfully sent chunk 8
[17:43:16.837] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.837] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.838] [WEBSOCKET_SEND] Sending 3236 bytes via WebSocket
[17:43:16.838] [WEBSOCKET_SENT] Successfully sent chunk 9
[17:43:16.838] [QUEUE_STATE] Queue has 0 items
[17:43:16.937] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:16.937] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:16.938] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:16.939] [WEBSOCKET_SENT] Successfully sent chunk 10
[17:43:17.037] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.037] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.038] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.039] [WEBSOCKET_SENT] Successfully sent chunk 11
[17:43:17.137] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.138] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.139] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.139] [WEBSOCKET_SENT] Successfully sent chunk 12
[17:43:17.237] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.237] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.238] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.238] [WEBSOCKET_SENT] Successfully sent chunk 13
[17:43:17.337] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.337] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.338] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.339] [WEBSOCKET_SENT] Successfully sent chunk 14
[17:43:17.437] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.437] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.438] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.438] [WEBSOCKET_SENT] Successfully sent chunk 15
[17:43:17.536] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.537] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.537] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.538] [WEBSOCKET_SENT] Successfully sent chunk 16
[17:43:17.637] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.637] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.638] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.638] [WEBSOCKET_SENT] Successfully sent chunk 17
[17:43:17.737] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.737] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.738] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.738] [WEBSOCKET_SENT] Successfully sent chunk 18
[17:43:17.836] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.837] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.838] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.838] [WEBSOCKET_SENT] Successfully sent chunk 19
[17:43:17.839] [QUEUE_STATE] Queue has 0 items
[17:43:17.937] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:17.937] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:17.938] [SERIALIZE_RESULT] Serialization complete
    Data: {'success': True, 'input_size': 3200, 'output_size': 3237, 'overhead_bytes': 37, 'time_ms': '0.00', 'compression_ratio': '1.01'}
[17:43:17.939] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:17.940] [WEBSOCKET_SENT] Successfully sent chunk 20
[17:43:18.037] [FRAME_CREATE] Creating OutputAudioRawFrame
    Data: {'audio_size': 3200, 'sample_rate': 16000, 'channels': 1}
[17:43:18.037] [SERIALIZE_START] Starting serialization of OutputAudioRawFrame
[17:43:18.038] [WEBSOCKET_SEND] Sending 3237 bytes via WebSocket
[17:43:18.038] [WEBSOCKET_SENT] Successfully sent chunk 21
[17:43:18.094] [INPUT] Enter pressed by user
[17:43:18.094] [USER] Stop requested
[17:43:18.144] [SEND] Ended send_audio task
    Data: {'total_chunks': 22, 'total_bytes': 70400}
[17:43:18.145] [RECEIVE] Started receive_responses task
[17:43:18.145] [FLOW] RECEIVE TASK: Waiting for server messages...
[17:43:18.145] [WEBSOCKET_RECV] Waiting for message #1
[17:43:18.146] [SHUTDOWN] Beginning shutdown sequence
[17:43:18.146] [AUDIO_STOP] Stopping audio input stream
[17:43:18.266] [AUDIO] Input stream closed
[17:43:18.267] [WAIT] Waiting 3 seconds for final responses
[17:43:21.233] [WEBSOCKET] Received message #1
    Data: {'type': 'binary', 'size': 1316}
[17:43:21.233] [RAW_MESSAGE] Binary message details
    Data: {'size': 1316, 'first_20_hex': '12a10a086012154f7574707574417564696f5261', 'last_10_hex': 'ffd6ff9aff20807d2801'}
[17:43:21.234] [DEBUG_FILE] Saved raw message to debug_session_20250604_174314/raw_msg_0.bin
[17:43:21.234] [DESERIALIZE_START] Starting deserialization of 1316 bytes
[17:43:21.234] [DESERIALIZE_SUCCESS] Deserialized to InputAudioRawFrame
[17:43:21.234] [FRAME_ATTRS] Frame attributes
    Data: {'audio': '1280 bytes', 'sample_rate': 16000, 'num_channels': 1}
[17:43:21.234] [AUDIO_FRAME] Processing audio frame #1
    Data: {'frame_type': 'InputAudioRawFrame', 'audio_size': 1280, 'total_received': 1280}
[17:43:21.234] [AUDIO] Received audio chunk 1
    Data: {'label': 'received', 'size_bytes': 1280, 'duration_ms': 40, 'sample_count': 640, 'max_value': 6, 'min_value': -4, 'avg_value': 0, 'is_silence': True, 'format': 'PCM'}
[17:43:21.235] [AUDIO_SAVED] Saved audio sample to debug_session_20250604_174314/received_1_22.wav
[17:43:21.235] [PLAYBACK_INIT] Initializing playback for first audio chunk
[17:43:21.235] [PLAYBACK_THREAD] Starting playback worker thread
[17:43:21.235] [PLAYBACK] Started playback thread
[17:43:21.235] [PCM_DIRECT] Audio is already PCM, queuing directly
[17:43:21.236] [PLAYBACK] Queued 1280 bytes for playback
[17:43:21.236] [WEBSOCKET_RECV] Waiting for message #2
[17:43:21.236] [WEBSOCKET] Received message #2
    Data: {'type': 'binary', 'size': 1316}
[17:43:21.236] [RAW_MESSAGE] Binary message details
    Data: {'size': 1316, 'first_20_hex': '12a10a086112154f7574707574417564696f5261', 'last_10_hex': 'fe5e005b0020807d2801'}
[17:43:21.237] [DEBUG_FILE] Saved raw message to debug_session_20250604_174314/raw_msg_1.bin
[17:43:21.237] [DESERIALIZE_START] Starting deserialization of 1316 bytes
[17:43:21.238] [DESERIALIZE_SUCCESS] Deserialized to InputAudioRawFrame
[17:43:21.238] [FRAME_ATTRS] Frame attributes
    Data: {'audio': '1280 bytes', 'sample_rate': 16000, 'num_channels': 1}
[17:43:21.238] [AUDIO_FRAME] Processing audio frame #2
    Data: {'frame_type': 'InputAudioRawFrame', 'audio_size': 1280, 'total_received': 2560}
[17:43:21.238] [AUDIO] Received audio chunk 2
    Data: {'label': 'received', 'size_bytes': 1280, 'duration_ms': 40, 'sample_count': 640, 'max_value': 455, 'min_value': -397, 'avg_value': 5, 'is_silence': True, 'format': 'PCM'}
[17:43:21.239] [AUDIO_SAVED] Saved audio sample to debug_session_20250604_174314/received_2_22.wav
[17:43:21.239] [PCM_DIRECT] Audio is already PCM, queuing directly
[17:43:21.239] [PLAYBACK] Queued 1280 bytes for playback
[17:43:21.239] [WEBSOCKET_RECV] Waiting for message #3
[17:43:21.273] [PLAYBACK_STOP] Setting stop flag for playback thread
[17:43:21.273] [THREAD_JOIN] Waiting for playback thread to finish
[17:43:21.383] [PLAYBACK] Audio output stream opened
    Data: {'format': 'pyaudio.paInt16', 'channels': 1, 'rate': 16000, 'chunk_size': 1600}
[17:43:21.384] [PLAYBACK_CLEANUP] Closing audio stream
[17:43:22.151] [PLAYBACK] Playback thread ended after 0 chunks
[17:43:22.151] [THREAD_JOINED] Playback thread finished
[17:43:22.152] [TASKS_CANCEL] Cancelling async tasks
[17:43:22.152] [TASKS_CANCELLED] All tasks cancelled
[17:43:22.153] [COMPLETE] Session ended successfully
[17:43:32.154] [CLEANUP] Starting final cleanup
[17:43:32.155] [CLEANUP] Audio terminated
